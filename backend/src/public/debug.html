<!DOCTYPE html>
<html>
<head>
    <title>Tetris Debug View</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        /* Styles pour une meilleure visualisation */
        .game-container {
            display: flex;
            padding: 20px;
            font-family: monospace;
            background: #f0f0f0;
        }

        .board {
            background: #000;
            padding: 10px;
            margin-right: 20px;
        }

        .row {
            display: flex;
        }

        .cell {
            width: 20px;
            height: 20px;
            border: 1px solid #333;
            margin: 1px;
        }

        .filled {
            background: #4CAF50;
        }

        .debug-panel {
            background: #fff;
            padding: 20px;
            border: 1px solid #ccc;
            min-width: 300px;
        }

        .event-log {
            height: 200px;
            overflow-y: auto;
            background: #f8f8f8;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Plateau de jeu -->
        <div class="board" id="gameBoard">
            <!-- Les cellules seront générées en JS -->
        </div>

        <!-- Panneau de debug -->
        <div class="debug-panel">
            <h3>Debug Controls</h3>
            <div>
                <input type="text" id="playerName" placeholder="Player Name">
                <input type="text" id="roomId" placeholder="Room ID">
                <button onclick="joinGame()">Join Game</button>
            </div>
            <div style="margin-top: 10px;">
                <button onclick="startGame()">Start Game</button>
                <button onclick="moveLeft()">←</button>
                <button onclick="moveRight()">→</button>
                <button onclick="moveDown()">↓</button>
                <button onclick="rotate()">Rotate</button>
            </div>
            <div style="margin-top: 20px;">
                <h4>État actuel:</h4>
                <pre id="gameState">En attente de connexion...</pre>
            </div>
            <div>
                <h4>Log des événements:</h4>
                <div id="eventLog" class="event-log"></div>
            </div>
        </div>
    </div>

    <script>
        // Initialisation de la connexion socket
        const socket = io('http://localhost:3000');
        let currentRoom = '';

        // Création du plateau de jeu vide
        function createEmptyBoard() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';
            for (let i = 0; i < 20; i++) {
                const row = document.createElement('div');
                row.className = 'row';
                for (let j = 0; j < 10; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.id = `cell-${i}-${j}`;
                    row.appendChild(cell);
                }
                board.appendChild(row);
            }
        }

        // Fonction pour mettre à jour le log
        function logEvent(message) {
            const log = document.getElementById('eventLog');
            const entry = document.createElement('div');
            entry.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            log.insertBefore(entry, log.firstChild);
        }

        // Fonction pour mettre à jour l'affichage du plateau
        function updateBoard(gameState) {
            if (!gameState || !gameState.board) return;
            
            gameState.board.forEach((row, i) => {
                row.forEach((cell, j) => {
                    const cellElement = document.getElementById(`cell-${i}-${j}`);
                    cellElement.className = `cell ${cell !== 0 ? 'filled' : ''}`;
                });
            });

            // Mise à jour de l'état affiché
            document.getElementById('gameState').textContent = 
                JSON.stringify(gameState, null, 2);
        }

        // Actions du jeu
        function joinGame() {
            const playerName = document.getElementById('playerName').value;
            const roomId = document.getElementById('roomId').value;
            currentRoom = roomId;

            socket.emit('init-player', {
                pseudo: playerName,
                room: roomId
            });
            logEvent(`Tentative de connexion: ${playerName} dans ${roomId}`);
        }

        function startGame() {
            socket.emit('start-game', { room: currentRoom });
            logEvent('Tentative de démarrage de la partie');
        }

        function moveLeft() {
            socket.emit('move-piece', { direction: 'left', roomId: currentRoom });
        }

        function moveRight() {
            socket.emit('move-piece', { direction: 'right', roomId: currentRoom });
        }

        function moveDown() {
            socket.emit('move-piece', { direction: 'down', roomId: currentRoom });
        }

        function rotate() {
            socket.emit('rotate-piece', { roomId: currentRoom });
        }

        // Écouteurs d'événements socket
        socket.on('connect', () => {
            logEvent('Connecté au serveur');
            createEmptyBoard();
        });

        socket.on('room-update', (data) => {
            logEvent(`Mise à jour de la room: ${JSON.stringify(data)}`);
        });

        socket.on('game-started', (data) => {
            logEvent('La partie commence!');
            updateBoard(data);
        });

        socket.on('game-update', (data) => {
            logEvent('Mise à jour du jeu reçue');
            updateBoard(data);
        });

        socket.on('error', (error) => {
            logEvent(`Erreur: ${error.message}`);
        });
    </script>
</body>
</html>